{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/lib/format.ts"],"sourcesContent":["export function formatDateShort(date: Date) {\n  return new Intl.DateTimeFormat(\"en-GB\", {\n    year: \"numeric\",\n    month: \"short\",\n    day: \"2-digit\",\n  }).format(date);\n}\n\nexport function formatBytes(bytes: number) {\n  if (bytes < 1024) {\n    return `${bytes} B`;\n  }\n  const units = [\"KB\", \"MB\", \"GB\"];\n  let size = bytes / 1024;\n  let unitIndex = 0;\n  while (size >= 1024 && unitIndex < units.length - 1) {\n    size /= 1024;\n    unitIndex += 1;\n  }\n  return `${size.toFixed(size >= 10 ? 0 : 1)} ${units[unitIndex]}`;\n}\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,gBAAgB,IAAU;IACxC,OAAO,IAAI,KAAK,cAAc,CAAC,SAAS;QACtC,MAAM;QACN,OAAO;QACP,KAAK;IACP,GAAG,MAAM,CAAC;AACZ;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI,QAAQ,MAAM;QAChB,OAAO,GAAG,MAAM,EAAE,CAAC;IACrB;IACA,MAAM,QAAQ;QAAC;QAAM;QAAM;KAAK;IAChC,IAAI,OAAO,QAAQ;IACnB,IAAI,YAAY;IAChB,MAAO,QAAQ,QAAQ,YAAY,MAAM,MAAM,GAAG,EAAG;QACnD,QAAQ;QACR,aAAa;IACf;IACA,OAAO,GAAG,KAAK,OAAO,CAAC,QAAQ,KAAK,IAAI,GAAG,CAAC,EAAE,KAAK,CAAC,UAAU,EAAE;AAClE"}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/app/portal/page.tsx"],"sourcesContent":["import Link from \"next/link\";\nimport { prisma } from \"@/lib/prisma\";\nimport { formatBytes, formatDateShort } from \"@/lib/format\";\nimport { getOrgScope, requirePortalSession } from \"@/lib/portal\";\n\nexport default async function PortalDashboardPage() {\n  const session = await requirePortalSession();\n  const scope = getOrgScope(session.user.role, session.user.orgId);\n\n  const [\n    engagementCount,\n    documentCount,\n    recentDocuments,\n    recentEvents,\n    pendingDeliverables,\n    pendingScopes,\n    engagementInputs,\n  ] = await Promise.all([\n    prisma.engagement.count({ where: scope }),\n    prisma.document.count({ where: scope }),\n    prisma.document.findMany({\n      where: scope,\n      orderBy: { createdAt: \"desc\" },\n      take: 5,\n      include: { engagement: true },\n    }),\n    prisma.auditEvent.findMany({\n      where: scope,\n      orderBy: { createdAt: \"desc\" },\n      take: 6,\n    }),\n    prisma.deliverable.findMany({\n      where: { ...scope, status: \"review\" },\n      orderBy: { createdAt: \"desc\" },\n      take: 5,\n      include: { engagement: true },\n    }),\n    prisma.scopeProposal.findMany({\n      where: { ...scope, status: \"sent\" },\n      orderBy: { createdAt: \"desc\" },\n      take: 3,\n    }),\n    prisma.engagement.findMany({\n      where: scope,\n      include: {\n        documents: { where: { category: \"client_input\" }, select: { id: true } },\n      },\n    }),\n  ]);\n\n  const missingInputs = engagementInputs.filter(\n    (engagement) => engagement.documents.length === 0,\n  );\n\n  return (\n    <div className=\"space-y-8\">\n      <div className=\"space-y-2\">\n        <p className=\"text-xs uppercase tracking-[0.3em] text-slate\">\n          Dashboard\n        </p>\n        <h1 className=\"text-2xl font-semibold text-ash\">Client overview</h1>\n        <p className=\"text-sm text-muted\">\n          Track engagements, documents, and recent activity in one place.\n        </p>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-3\">\n        {[\n          {\n            label: \"Active engagements\",\n            value: engagementCount,\n            hint: \"Current delivery stages\",\n            href: \"/portal/engagements\",\n          },\n          {\n            label: \"Documents\",\n            value: documentCount,\n            hint: \"NDAs, SOWs, deliverables\",\n            href: \"/portal/documents\",\n          },\n          {\n            label: \"Recent activity\",\n            value: recentEvents.length,\n            hint: \"Latest portal actions\",\n            href: \"/portal/engagements\",\n          },\n        ].map((card) => (\n          <Link\n            key={card.label}\n            href={card.href}\n            className=\"card-animate rounded-2xl border border-line/80 bg-soft p-5 transition hover:border-slate\"\n          >\n            <div className=\"text-xs uppercase tracking-[0.2em] text-slate\">\n              {card.label}\n            </div>\n            <div className=\"mt-3 text-2xl font-semibold text-ash\">\n              {card.value}\n            </div>\n            <p className=\"mt-2 text-xs text-muted\">{card.hint}</p>\n          </Link>\n        ))}\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        <div className=\"rounded-2xl border border-line/80 bg-soft p-6\">\n          <h2 className=\"text-sm uppercase tracking-[0.2em] text-slate\">\n            Recent documents\n          </h2>\n          {recentDocuments.length === 0 ? (\n            <p className=\"mt-4 text-sm text-muted\">\n              No documents uploaded yet. Engagement files will appear here once\n              added.\n            </p>\n          ) : (\n            <div className=\"mt-4 space-y-3 text-sm text-muted\">\n              {recentDocuments.map((doc) => (\n                <div\n                  key={doc.id}\n                  className=\"flex items-center justify-between gap-4 rounded-xl border border-line/80 bg-ink px-4 py-3\"\n                >\n                  <div>\n                    <div className=\"text-ash\">{doc.name}</div>\n                    <div className=\"text-xs text-slate\">\n                      {doc.engagement?.title ?? \"Document\"} · {doc.category}\n                    </div>\n                  </div>\n                  <div className=\"text-xs text-slate\">\n                    {formatBytes(doc.size)} · {formatDateShort(doc.createdAt)}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        <div className=\"rounded-2xl border border-line/80 bg-soft p-6\">\n          <h2 className=\"text-sm uppercase tracking-[0.2em] text-slate\">\n            Recent activity\n          </h2>\n          {recentEvents.length === 0 ? (\n            <p className=\"mt-4 text-sm text-muted\">\n              No activity logged yet. Actions will appear as the portal is used.\n            </p>\n          ) : (\n            <ul className=\"mt-4 space-y-3 text-sm text-muted\">\n              {recentEvents.map((event) => (\n                <li\n                  key={event.id}\n                  className=\"flex items-center justify-between gap-4 rounded-xl border border-line/80 bg-ink px-4 py-3\"\n                >\n                  <div>\n                    <div className=\"text-ash\">{event.action}</div>\n                    <div className=\"text-xs text-slate\">\n                      {event.resourceType}\n                    </div>\n                  </div>\n                  <div className=\"text-xs text-slate\">\n                    {formatDateShort(event.createdAt)}\n                  </div>\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n      </div>\n\n      <div className=\"rounded-2xl border border-line/80 bg-soft p-6\">\n        <h2 className=\"text-sm uppercase tracking-[0.2em] text-slate\">\n          Action required\n        </h2>\n        {pendingDeliverables.length === 0 &&\n        missingInputs.length === 0 &&\n        pendingScopes.length === 0 ? (\n          <p className=\"mt-4 text-sm text-muted\">\n            No pending approvals or missing inputs right now.\n          </p>\n        ) : (\n          <div className=\"mt-4 space-y-3 text-sm text-muted\">\n            {pendingScopes.map((scopeProposal) => (\n              <div\n                key={scopeProposal.id}\n                className=\"rounded-xl border border-line/80 bg-ink px-4 py-3\"\n              >\n                <div className=\"text-ash\">Review scope proposal</div>\n                <div className=\"text-xs text-slate\">\n                  Scope proposal {scopeProposal.title ?? \"pending\"} is ready for review.\n                </div>\n              </div>\n            ))}\n            {pendingDeliverables.map((deliverable) => (\n              <div\n                key={deliverable.id}\n                className=\"rounded-xl border border-line/80 bg-ink px-4 py-3\"\n              >\n                <div className=\"text-ash\">\n                  Approval needed: {deliverable.title}\n                </div>\n                <div className=\"text-xs text-slate\">\n                  {deliverable.engagement?.title ?? \"Engagement deliverable\"}\n                </div>\n              </div>\n            ))}\n            {missingInputs.map((engagement) => (\n              <div\n                key={engagement.id}\n                className=\"rounded-xl border border-line/80 bg-ink px-4 py-3\"\n              >\n                <div className=\"text-ash\">\n                  Client input requested for {engagement.title}\n                </div>\n                <div className=\"text-xs text-slate\">\n                  Upload requirements or evidence to proceed.\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}