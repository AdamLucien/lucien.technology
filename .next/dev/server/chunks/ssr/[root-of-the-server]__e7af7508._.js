module.exports = [
"[project]/components/portal/PortalShell.tsx [app-rsc] (client reference proxy) <module evaluation>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "PortalShell",
    ()=>PortalShell
]);
// This file is generated by next-core EcmascriptClientReferenceModule.
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server.js [app-rsc] (ecmascript)");
;
const PortalShell = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call PortalShell() from the server but PortalShell is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/components/portal/PortalShell.tsx <module evaluation>", "PortalShell");
}),
"[project]/components/portal/PortalShell.tsx [app-rsc] (client reference proxy)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "PortalShell",
    ()=>PortalShell
]);
// This file is generated by next-core EcmascriptClientReferenceModule.
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server.js [app-rsc] (ecmascript)");
;
const PortalShell = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call PortalShell() from the server but PortalShell is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/components/portal/PortalShell.tsx", "PortalShell");
}),
"[project]/components/portal/PortalShell.tsx [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$portal$2f$PortalShell$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/components/portal/PortalShell.tsx [app-rsc] (client reference proxy) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$portal$2f$PortalShell$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__ = __turbopack_context__.i("[project]/components/portal/PortalShell.tsx [app-rsc] (client reference proxy)");
;
__turbopack_context__.n(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$portal$2f$PortalShell$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__);
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/assert [external] (assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}),
"[externals]/querystring [external] (querystring, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/dns [external] (dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/child_process [external] (child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}),
"[project]/lib/prisma.ts [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "prisma",
    ()=>prisma
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f40$prisma$2f$client$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs, [project]/node_modules/@prisma/client)");
;
if (!process.env.DATABASE_URL) {
    throw new Error("DATABASE_URL is not set. Configure a Postgres connection string.");
}
const globalForPrisma = /*TURBOPACK member replacement*/ __turbopack_context__.g;
const prisma = globalForPrisma.prisma ?? new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f40$prisma$2f$client$29$__["PrismaClient"]({
    log: ("TURBOPACK compile-time truthy", 1) ? [
        "error"
    ] : "TURBOPACK unreachable"
});
if ("TURBOPACK compile-time truthy", 1) {
    globalForPrisma.prisma = prisma;
}
}),
"[project]/lib/audit.ts [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "logAuditEvent",
    ()=>logAuditEvent
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/prisma.ts [app-rsc] (ecmascript)");
;
async function logAuditEvent({ orgId, action, resourceType, resourceId, userId, meta, ip, userAgent }) {
    try {
        await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].auditEvent.create({
            data: {
                orgId,
                action,
                resourceType,
                resourceId: resourceId ?? null,
                userId: userId ?? null,
                metaJson: meta ? JSON.stringify(meta) : null,
                ip: ip ?? null,
                userAgent: userAgent ?? null
            }
        });
    } catch (error) {
        console.error("AuditEventFailed", error);
    }
}
}),
"[project]/lib/org.ts [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getDomainFromEmail",
    ()=>getDomainFromEmail,
    "getOrCreateOrg",
    ()=>getOrCreateOrg
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/prisma.ts [app-rsc] (ecmascript)");
;
function getDomainFromEmail(email) {
    const [, domain] = email.toLowerCase().split("@");
    return domain ?? null;
}
async function getOrCreateOrg({ name, domain }) {
    if (domain) {
        const existing = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].org.findFirst({
            where: {
                domain
            }
        });
        if (existing) {
            return existing;
        }
    }
    const existingByName = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].org.findUnique({
        where: {
            name
        }
    });
    if (existingByName) {
        if (!existingByName.domain && domain) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].org.update({
                where: {
                    id: existingByName.id
                },
                data: {
                    domain
                }
            });
        }
        return existingByName;
    }
    return __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].org.create({
        data: {
            name,
            domain: domain ?? undefined
        }
    });
}
}),
"[project]/lib/auth.ts [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "authOptions",
    ()=>authOptions,
    "getServerAuthSession",
    ()=>getServerAuthSession
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/index.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$email$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/providers/email.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/providers/credentials.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@auth/prisma-adapter/index.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nodemailer$2f$lib$2f$nodemailer$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/nodemailer/lib/nodemailer.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/prisma.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$brand$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/brand.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$audit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/audit.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$org$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/org.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2d$helpers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/auth-helpers.ts [app-rsc] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
const devLoginEmails = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2d$helpers$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getDevLoginEmails"])();
if ("TURBOPACK compile-time truthy", 1) {
    if (!process.env.NEXTAUTH_URL) {
        process.env.NEXTAUTH_URL = "http://localhost:3000";
    }
    if (!process.env.NEXTAUTH_SECRET) {
        process.env.NEXTAUTH_SECRET = "dev-secret-change-me";
    }
}
async function sendMagicLink(params) {
    const { identifier, url, provider } = params;
    if (!provider.server) {
        if ("TURBOPACK compile-time truthy", 1) {
            console.info("DevMagicLink", {
                email: identifier,
                url
            });
            return;
        }
        //TURBOPACK unreachable
        ;
    }
    const transport = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nodemailer$2f$lib$2f$nodemailer$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createTransport"])(provider.server);
    const fromAddress = provider.from ?? __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$brand$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["brand"].email;
    await transport.sendMail({
        to: identifier,
        from: fromAddress,
        subject: `Sign in to ${__TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$brand$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["brand"].wordmark}`,
        text: `Use this link to sign in: ${url}`,
        html: `<p>Use this link to sign in:</p><p><a href="${url}">${url}</a></p>`
    });
}
const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["PrismaAdapter"])(__TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"]);
adapter.createUser = async (data)=>{
    const email = data.email.toLowerCase();
    const domain = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$org$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getDomainFromEmail"])(email);
    const isLucien = email.includes("lucien");
    const orgName = isLucien ? "Lucien Internal" : domain ?? "Client Workspace";
    const org = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$org$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOrCreateOrg"])({
        name: orgName,
        domain
    });
    const role = isLucien && (email.startsWith("ops@") || email.startsWith("operator@")) ? "lucien_operator" : isLucien ? "lucien_admin" : "org_user";
    return __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].user.create({
        data: {
            email,
            name: data.name,
            emailVerified: data.emailVerified,
            role,
            orgId: org.id
        }
    });
};
const authOptions = {
    adapter,
    secret: process.env.NEXTAUTH_SECRET,
    pages: {
        signIn: "/login"
    },
    session: {
        strategy: "jwt"
    },
    providers: [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$email$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["default"])({
            server: process.env.EMAIL_SERVER,
            from: process.env.EMAIL_FROM ?? __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$brand$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["brand"].email,
            sendVerificationRequest: sendMagicLink
        }),
        ...("TURBOPACK compile-time value", "development") === "development" && devLoginEmails.length > 0 ? [
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["default"])({
                id: "dev-login",
                name: "Dev Login",
                credentials: {
                    email: {
                        label: "Email",
                        type: "text"
                    }
                },
                async authorize (credentials) {
                    const email = credentials?.email?.toLowerCase();
                    if (!email || !devLoginEmails.includes(email)) {
                        return null;
                    }
                    const domain = (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$org$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getDomainFromEmail"])(email);
                    const isLucien = email.includes("lucien");
                    const orgName = isLucien ? "Lucien Internal" : "Client Workspace";
                    const org = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$org$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOrCreateOrg"])({
                        name: orgName,
                        domain
                    });
                    const role = isLucien ? email.startsWith("ops@") || email.startsWith("operator@") ? "lucien_operator" : "lucien_admin" : email.startsWith("admin@") ? "org_admin" : "org_user";
                    const user = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].user.upsert({
                        where: {
                            email
                        },
                        update: {
                            role,
                            orgId: org.id,
                            lastLoginAt: new Date()
                        },
                        create: {
                            email,
                            role,
                            orgId: org.id,
                            name: email.split("@")[0],
                            lastLoginAt: new Date()
                        }
                    });
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$audit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["logAuditEvent"])({
                        orgId: org.id,
                        userId: user.id,
                        action: "login",
                        resourceType: "user",
                        resourceId: user.id,
                        meta: {
                            source: "dev-login"
                        }
                    });
                    return user;
                }
            })
        ] : []
    ],
    callbacks: {
        async session ({ session, token, user }) {
            if (session.user) {
                session.user.id = user?.id ?? token.sub;
                session.user.role = user?.role ?? token.role;
                session.user.orgId = user?.orgId ?? token.orgId;
            }
            return session;
        },
        async jwt ({ token, user }) {
            if (user) {
                token.role = user.role;
                token.orgId = user.orgId;
            }
            return token;
        }
    },
    events: {
        async signIn ({ user }) {
            if (!user?.id || !user.orgId) {
                return;
            }
            await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].user.update({
                where: {
                    id: user.id
                },
                data: {
                    lastLoginAt: new Date()
                }
            });
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$audit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["logAuditEvent"])({
                orgId: user.orgId,
                userId: user.id,
                action: "login",
                resourceType: "user",
                resourceId: user.id,
                meta: {
                    source: "email"
                }
            });
        },
        async signOut ({ session }) {
            const userId = session?.user?.id;
            const orgId = session?.user?.orgId;
            if (!userId || !orgId) {
                return;
            }
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$audit$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["logAuditEvent"])({
                orgId,
                userId,
                action: "logout",
                resourceType: "user",
                resourceId: userId
            });
        }
    }
};
function getServerAuthSession() {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getServerSession"])(authOptions);
}
}),
"[project]/lib/portal.ts [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getOrgScope",
    ()=>getOrgScope,
    "requireLucienAdmin",
    ()=>requireLucienAdmin,
    "requireLucienStaff",
    ()=>requireLucienStaff,
    "requirePortalSession",
    ()=>requirePortalSession
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/auth.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$api$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/next/dist/api/navigation.react-server.js [app-rsc] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/client/components/navigation.react-server.js [app-rsc] (ecmascript)");
;
;
async function requirePortalSession() {
    const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getServerAuthSession"])();
    if (!session?.user) {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["redirect"])("/login?callbackUrl=/portal");
    }
    return session;
}
function requireLucienAdmin(role) {
    if (role !== "lucien_admin") {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["notFound"])();
    }
}
function requireLucienStaff(role) {
    if (role !== "lucien_admin" && role !== "lucien_operator") {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["notFound"])();
    }
}
function getOrgScope(role, orgId) {
    if (role === "lucien_admin" || role === "lucien_operator") {
        return {};
    }
    return {
        orgId: orgId ?? ""
    };
}
}),
"[project]/app/portal/layout.tsx [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>PortalLayout,
    "dynamic",
    ()=>dynamic,
    "metadata",
    ()=>metadata
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-jsx-dev-runtime.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$api$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/next/dist/api/navigation.react-server.js [app-rsc] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/client/components/navigation.react-server.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$components$2f$portal$2f$PortalShell$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/components/portal/PortalShell.tsx [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$portal$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/portal.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/prisma.ts [app-rsc] (ecmascript)");
;
;
;
;
;
const metadata = {
    title: "Client Portal | Lucien",
    description: "Secure Lucien client portal for engagements and documents.",
    robots: {
        index: false,
        follow: false,
        nocache: true
    }
};
const dynamic = "force-dynamic";
async function PortalLayout({ children }) {
    const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$portal$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["requirePortalSession"])();
    const user = await __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].user.findUnique({
        where: {
            id: session.user.id
        },
        include: {
            org: true
        }
    });
    if (!user) {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["redirect"])("/login?callbackUrl=/portal");
    }
    const [unreadNotifications, recentNotifications] = await Promise.all([
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].notification.count({
            where: {
                recipientUserId: user.id,
                readAt: null
            }
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$prisma$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["prisma"].notification.findMany({
            where: {
                recipientUserId: user.id
            },
            orderBy: {
                createdAt: "desc"
            },
            take: 8
        })
    ]);
    const navItems = [
        {
            href: "/portal",
            label: "Dashboard",
            icon: "dashboard"
        },
        {
            href: "/portal/engagements",
            label: "Engagements",
            icon: "engagements"
        },
        {
            href: "/portal/hr",
            label: "HR",
            icon: "users"
        },
        {
            href: "/portal/change-requests",
            label: "Change Requests",
            icon: "changeRequests"
        },
        {
            href: "/portal/scopes",
            label: "Scopes",
            icon: "scopes"
        },
        {
            href: "/portal/documents",
            label: "Documents",
            icon: "documents"
        }
    ];
    if (user.role.startsWith("org_")) {
        navItems.push({
            href: "/portal/billing",
            label: "Billing",
            icon: "billing"
        });
    } else {
        navItems.push({
            href: "/portal/finance",
            label: "Finance",
            icon: "finance"
        });
    }
    navItems.push({
        href: "/portal/notifications",
        label: "Notifications",
        icon: "notifications"
    });
    if (user.role === "lucien_admin") {
        navItems.splice(1, 0, {
            href: "/portal/inquiries",
            label: "Inquiries",
            icon: "inquiries"
        });
        navItems.push({
            href: "/portal/admin/orgs",
            label: "Admin: Orgs",
            icon: "orgs"
        });
        navItems.push({
            href: "/portal/admin/users",
            label: "Admin: Users",
            icon: "users"
        });
        navItems.push({
            href: "/portal/admin/danger-zone",
            label: "Admin: Danger",
            icon: "danger"
        });
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$components$2f$portal$2f$PortalShell$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["PortalShell"], {
        navItems: navItems,
        orgName: user.org.name,
        userEmail: user.email,
        userRole: user.role,
        unreadNotifications: unreadNotifications,
        recentNotifications: recentNotifications.map((item)=>({
                id: item.id,
                type: item.type,
                title: item.title,
                body: item.body,
                createdAt: item.createdAt.toISOString(),
                readAt: item.readAt ? item.readAt.toISOString() : null
            })),
        requiresOnboarding: user.role.startsWith("org_") && !user.onboardedAt,
        children: children
    }, void 0, false, {
        fileName: "[project]/app/portal/layout.tsx",
        lineNumber: 110,
        columnNumber: 5
    }, this);
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__e7af7508._.js.map