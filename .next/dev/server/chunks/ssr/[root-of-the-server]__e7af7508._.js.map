{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/components/portal/PortalShell.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PortalShell = registerClientReference(\n    function() { throw new Error(\"Attempted to call PortalShell() from the server but PortalShell is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/portal/PortalShell.tsx <module evaluation>\",\n    \"PortalShell\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,cAAc,IAAA,wQAAuB,EAC9C;IAAa,MAAM,IAAI,MAAM;AAAsO,GACnQ,mEACA","ignoreList":[0]}},
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/components/portal/PortalShell.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const PortalShell = registerClientReference(\n    function() { throw new Error(\"Attempted to call PortalShell() from the server but PortalShell is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/portal/PortalShell.tsx\",\n    \"PortalShell\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,cAAc,IAAA,wQAAuB,EAC9C;IAAa,MAAM,IAAI,MAAM;AAAsO,GACnQ,+CACA","ignoreList":[0]}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL is not set. Configure a Postgres connection string.\");\n}\n\nconst globalForPrisma = global as typeof global & {\n  prisma?: PrismaClient;\n};\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: process.env.NODE_ENV === \"development\" ? [\"error\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":";;;;AAAA;;AACA,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM;AAIC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;KAAQ,GAAG;AAC5D;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B"}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/lib/audit.ts"],"sourcesContent":["import { prisma } from \"@/lib/prisma\";\n\nexport type AuditInput = {\n  orgId: string;\n  action: string;\n  resourceType: string;\n  resourceId?: string | null;\n  userId?: string | null;\n  meta?: Record<string, unknown> | null;\n  ip?: string | null;\n  userAgent?: string | null;\n};\n\nexport async function logAuditEvent({\n  orgId,\n  action,\n  resourceType,\n  resourceId,\n  userId,\n  meta,\n  ip,\n  userAgent,\n}: AuditInput) {\n  try {\n    await prisma.auditEvent.create({\n      data: {\n        orgId,\n        action,\n        resourceType,\n        resourceId: resourceId ?? null,\n        userId: userId ?? null,\n        metaJson: meta ? JSON.stringify(meta) : null,\n        ip: ip ?? null,\n        userAgent: userAgent ?? null,\n      },\n    });\n  } catch (error) {\n    console.error(\"AuditEventFailed\", error);\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAaO,eAAe,cAAc,EAClC,KAAK,EACL,MAAM,EACN,YAAY,EACZ,UAAU,EACV,MAAM,EACN,IAAI,EACJ,EAAE,EACF,SAAS,EACE;IACX,IAAI;QACF,MAAM,uHAAM,CAAC,UAAU,CAAC,MAAM,CAAC;YAC7B,MAAM;gBACJ;gBACA;gBACA;gBACA,YAAY,cAAc;gBAC1B,QAAQ,UAAU;gBAClB,UAAU,OAAO,KAAK,SAAS,CAAC,QAAQ;gBACxC,IAAI,MAAM;gBACV,WAAW,aAAa;YAC1B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;IACpC;AACF"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/lib/org.ts"],"sourcesContent":["import { prisma } from \"@/lib/prisma\";\n\nexport function getDomainFromEmail(email: string) {\n  const [, domain] = email.toLowerCase().split(\"@\");\n  return domain ?? null;\n}\n\ntype OrgInput = {\n  name: string;\n  domain?: string | null;\n};\n\nexport async function getOrCreateOrg({ name, domain }: OrgInput) {\n  if (domain) {\n    const existing = await prisma.org.findFirst({ where: { domain } });\n    if (existing) {\n      return existing;\n    }\n  }\n\n  const existingByName = await prisma.org.findUnique({ where: { name } });\n  if (existingByName) {\n    if (!existingByName.domain && domain) {\n      return prisma.org.update({\n        where: { id: existingByName.id },\n        data: { domain },\n      });\n    }\n    return existingByName;\n  }\n\n  return prisma.org.create({\n    data: {\n      name,\n      domain: domain ?? undefined,\n    },\n  });\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,SAAS,mBAAmB,KAAa;IAC9C,MAAM,GAAG,OAAO,GAAG,MAAM,WAAW,GAAG,KAAK,CAAC;IAC7C,OAAO,UAAU;AACnB;AAOO,eAAe,eAAe,EAAE,IAAI,EAAE,MAAM,EAAY;IAC7D,IAAI,QAAQ;QACV,MAAM,WAAW,MAAM,uHAAM,CAAC,GAAG,CAAC,SAAS,CAAC;YAAE,OAAO;gBAAE;YAAO;QAAE;QAChE,IAAI,UAAU;YACZ,OAAO;QACT;IACF;IAEA,MAAM,iBAAiB,MAAM,uHAAM,CAAC,GAAG,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE;QAAK;IAAE;IACrE,IAAI,gBAAgB;QAClB,IAAI,CAAC,eAAe,MAAM,IAAI,QAAQ;YACpC,OAAO,uHAAM,CAAC,GAAG,CAAC,MAAM,CAAC;gBACvB,OAAO;oBAAE,IAAI,eAAe,EAAE;gBAAC;gBAC/B,MAAM;oBAAE;gBAAO;YACjB;QACF;QACA,OAAO;IACT;IAEA,OAAO,uHAAM,CAAC,GAAG,CAAC,MAAM,CAAC;QACvB,MAAM;YACJ;YACA,QAAQ,UAAU;QACpB;IACF;AACF"}},
    {"offset": {"line": 238, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/lib/auth.ts"],"sourcesContent":["import type { NextAuthOptions } from \"next-auth\";\nimport { getServerSession } from \"next-auth\";\nimport EmailProvider from \"next-auth/providers/email\";\nimport type { SendVerificationRequestParams } from \"next-auth/providers/email\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport { PrismaAdapter } from \"@auth/prisma-adapter\";\nimport { createTransport } from \"nodemailer\";\nimport type { TransportOptions } from \"nodemailer\";\nimport { prisma } from \"@/lib/prisma\";\nimport { brand } from \"@/lib/brand\";\nimport { logAuditEvent } from \"@/lib/audit\";\nimport { getDomainFromEmail, getOrCreateOrg } from \"@/lib/org\";\nimport { getDevLoginEmails } from \"@/lib/auth-helpers\";\n\nconst devLoginEmails = getDevLoginEmails();\n\nif (process.env.NODE_ENV === \"development\") {\n  if (!process.env.NEXTAUTH_URL) {\n    process.env.NEXTAUTH_URL = \"http://localhost:3000\";\n  }\n  if (!process.env.NEXTAUTH_SECRET) {\n    process.env.NEXTAUTH_SECRET = \"dev-secret-change-me\";\n  }\n}\n\nasync function sendMagicLink(params: SendVerificationRequestParams) {\n  const { identifier, url, provider } = params;\n\n  if (!provider.server) {\n    if (process.env.NODE_ENV === \"development\") {\n      console.info(\"DevMagicLink\", { email: identifier, url });\n      return;\n    }\n    throw new Error(\"EMAIL_SERVER is not configured.\");\n  }\n\n  const transport = createTransport(provider.server as TransportOptions | string);\n  const fromAddress = provider.from ?? brand.email;\n\n  await transport.sendMail({\n    to: identifier,\n    from: fromAddress,\n    subject: `Sign in to ${brand.wordmark}`,\n    text: `Use this link to sign in: ${url}`,\n    html: `<p>Use this link to sign in:</p><p><a href=\"${url}\">${url}</a></p>`,\n  });\n}\n\nconst adapter = PrismaAdapter(prisma);\nadapter.createUser = async (data) => {\n  const email = data.email.toLowerCase();\n  const domain = getDomainFromEmail(email);\n  const isLucien = email.includes(\"lucien\");\n  const orgName = isLucien ? \"Lucien Internal\" : domain ?? \"Client Workspace\";\n  const org = await getOrCreateOrg({ name: orgName, domain });\n  const role =\n    isLucien && (email.startsWith(\"ops@\") || email.startsWith(\"operator@\"))\n      ? \"lucien_operator\"\n      : isLucien\n        ? \"lucien_admin\"\n        : \"org_user\";\n\n  return prisma.user.create({\n    data: {\n      email,\n      name: data.name,\n      emailVerified: data.emailVerified,\n      role,\n      orgId: org.id,\n    },\n  });\n};\n\nexport const authOptions: NextAuthOptions = {\n  adapter,\n  secret: process.env.NEXTAUTH_SECRET,\n  pages: {\n    signIn: \"/login\",\n  },\n  session: {\n    strategy: \"jwt\",\n  },\n  providers: [\n    EmailProvider({\n      server: process.env.EMAIL_SERVER,\n      from: process.env.EMAIL_FROM ?? brand.email,\n      sendVerificationRequest: sendMagicLink,\n    }),\n    ...(process.env.NODE_ENV === \"development\" && devLoginEmails.length > 0\n      ? [\n          CredentialsProvider({\n            id: \"dev-login\",\n            name: \"Dev Login\",\n            credentials: {\n              email: { label: \"Email\", type: \"text\" },\n            },\n            async authorize(credentials) {\n              const email = credentials?.email?.toLowerCase();\n              if (!email || !devLoginEmails.includes(email)) {\n                return null;\n              }\n\n              const domain = getDomainFromEmail(email);\n              const isLucien = email.includes(\"lucien\");\n              const orgName = isLucien\n                ? \"Lucien Internal\"\n                : \"Client Workspace\";\n              const org = await getOrCreateOrg({ name: orgName, domain });\n\n              const role = isLucien\n                ? email.startsWith(\"ops@\") || email.startsWith(\"operator@\")\n                  ? \"lucien_operator\"\n                  : \"lucien_admin\"\n                : email.startsWith(\"admin@\")\n                  ? \"org_admin\"\n                  : \"org_user\";\n\n              const user = await prisma.user.upsert({\n                where: { email },\n                update: {\n                  role,\n                  orgId: org.id,\n                  lastLoginAt: new Date(),\n                },\n                create: {\n                  email,\n                  role,\n                  orgId: org.id,\n                  name: email.split(\"@\")[0],\n                  lastLoginAt: new Date(),\n                },\n              });\n\n              await logAuditEvent({\n                orgId: org.id,\n                userId: user.id,\n                action: \"login\",\n                resourceType: \"user\",\n                resourceId: user.id,\n                meta: { source: \"dev-login\" },\n              });\n\n              return user;\n            },\n          }),\n        ]\n      : []),\n  ],\n  callbacks: {\n    async session({ session, token, user }) {\n      if (session.user) {\n        session.user.id = user?.id ?? (token.sub as string | undefined);\n        session.user.role = (user?.role ?? token.role) as string | undefined;\n        session.user.orgId = (user?.orgId ?? token.orgId) as string | undefined;\n      }\n      return session;\n    },\n    async jwt({ token, user }) {\n      if (user) {\n        token.role = user.role;\n        token.orgId = user.orgId;\n      }\n      return token;\n    },\n  },\n  events: {\n    async signIn({ user }) {\n      if (!user?.id || !user.orgId) {\n        return;\n      }\n      await prisma.user.update({\n        where: { id: user.id },\n        data: { lastLoginAt: new Date() },\n      });\n      await logAuditEvent({\n        orgId: user.orgId,\n        userId: user.id,\n        action: \"login\",\n        resourceType: \"user\",\n        resourceId: user.id,\n        meta: { source: \"email\" },\n      });\n    },\n    async signOut({ session }) {\n      const userId = session?.user?.id;\n      const orgId = session?.user?.orgId;\n      if (!userId || !orgId) {\n        return;\n      }\n      await logAuditEvent({\n        orgId,\n        userId,\n        action: \"logout\",\n        resourceType: \"user\",\n        resourceId: userId,\n      });\n    },\n  },\n};\n\nexport function getServerAuthSession() {\n  return getServerSession(authOptions);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 451, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/lib/portal.ts"],"sourcesContent":["import { getServerAuthSession } from \"@/lib/auth\";\nimport { notFound, redirect } from \"next/navigation\";\n\nexport async function requirePortalSession() {\n  const session = await getServerAuthSession();\n  if (!session?.user) {\n    redirect(\"/login?callbackUrl=/portal\");\n  }\n  return session;\n}\n\nexport function requireLucienAdmin(role?: string | null) {\n  if (role !== \"lucien_admin\") {\n    notFound();\n  }\n}\n\nexport function requireLucienStaff(role?: string | null) {\n  if (role !== \"lucien_admin\" && role !== \"lucien_operator\") {\n    notFound();\n  }\n}\n\nexport function getOrgScope(role: string | undefined, orgId: string | undefined) {\n  if (role === \"lucien_admin\" || role === \"lucien_operator\") {\n    return {};\n  }\n  return { orgId: orgId ?? \"\" };\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;;;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM,IAAA,mIAAoB;IAC1C,IAAI,CAAC,SAAS,MAAM;QAClB,IAAA,iMAAQ,EAAC;IACX;IACA,OAAO;AACT;AAEO,SAAS,mBAAmB,IAAoB;IACrD,IAAI,SAAS,gBAAgB;QAC3B,IAAA,iMAAQ;IACV;AACF;AAEO,SAAS,mBAAmB,IAAoB;IACrD,IAAI,SAAS,kBAAkB,SAAS,mBAAmB;QACzD,IAAA,iMAAQ;IACV;AACF;AAEO,SAAS,YAAY,IAAwB,EAAE,KAAyB;IAC7E,IAAI,SAAS,kBAAkB,SAAS,mBAAmB;QACzD,OAAO,CAAC;IACV;IACA,OAAO;QAAE,OAAO,SAAS;IAAG;AAC9B"}},
    {"offset": {"line": 495, "column": 0}, "map": {"version":3,"sources":["file:///Users/adamkarllucien/Lucien_technology/lucien.technology/app/portal/layout.tsx"],"sourcesContent":["import type { Metadata } from \"next\";\nimport { redirect } from \"next/navigation\";\nimport { PortalShell, type PortalNavItem } from \"@/components/portal/PortalShell\";\nimport { requirePortalSession } from \"@/lib/portal\";\nimport { prisma } from \"@/lib/prisma\";\n\nexport const metadata: Metadata = {\n  title: \"Client Portal | Lucien\",\n  description: \"Secure Lucien client portal for engagements and documents.\",\n  robots: { index: false, follow: false, nocache: true },\n};\n\nexport const dynamic = \"force-dynamic\";\n\nexport default async function PortalLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const session = await requirePortalSession();\n  const user = await prisma.user.findUnique({\n    where: { id: session.user.id },\n    include: { org: true },\n  });\n\n  if (!user) {\n    redirect(\"/login?callbackUrl=/portal\");\n  }\n\n  const [unreadNotifications, recentNotifications] = await Promise.all([\n    prisma.notification.count({\n      where: { recipientUserId: user.id, readAt: null },\n    }),\n    prisma.notification.findMany({\n      where: { recipientUserId: user.id },\n      orderBy: { createdAt: \"desc\" },\n      take: 8,\n    }),\n  ]);\n\n  const navItems: PortalNavItem[] = [\n    { href: \"/portal\", label: \"Dashboard\", icon: \"dashboard\" },\n    {\n      href: \"/portal/engagements\",\n      label: \"Engagements\",\n      icon: \"engagements\",\n    },\n    {\n      href: \"/portal/hr\",\n      label: \"HR\",\n      icon: \"users\",\n    },\n    {\n      href: \"/portal/change-requests\",\n      label: \"Change Requests\",\n      icon: \"changeRequests\",\n    },\n    { href: \"/portal/scopes\", label: \"Scopes\", icon: \"scopes\" },\n    {\n      href: \"/portal/documents\",\n      label: \"Documents\",\n      icon: \"documents\",\n    },\n  ];\n\n  if (user.role.startsWith(\"org_\")) {\n    navItems.push({\n      href: \"/portal/billing\",\n      label: \"Billing\",\n      icon: \"billing\",\n    });\n  } else {\n    navItems.push({\n      href: \"/portal/finance\",\n      label: \"Finance\",\n      icon: \"finance\",\n    });\n  }\n\n  navItems.push({\n    href: \"/portal/notifications\",\n    label: \"Notifications\",\n    icon: \"notifications\",\n  });\n\n  if (user.role === \"lucien_admin\") {\n    navItems.splice(1, 0, {\n      href: \"/portal/inquiries\",\n      label: \"Inquiries\",\n      icon: \"inquiries\",\n    });\n    navItems.push({\n      href: \"/portal/admin/orgs\",\n      label: \"Admin: Orgs\",\n      icon: \"orgs\",\n    });\n    navItems.push({\n      href: \"/portal/admin/users\",\n      label: \"Admin: Users\",\n      icon: \"users\",\n    });\n    navItems.push({\n      href: \"/portal/admin/danger-zone\",\n      label: \"Admin: Danger\",\n      icon: \"danger\",\n    });\n  }\n\n  return (\n    <PortalShell\n      navItems={navItems}\n      orgName={user.org.name}\n      userEmail={user.email}\n      userRole={user.role}\n      unreadNotifications={unreadNotifications}\n      recentNotifications={recentNotifications.map((item) => ({\n        id: item.id,\n        type: item.type,\n        title: item.title,\n        body: item.body,\n        createdAt: item.createdAt.toISOString(),\n        readAt: item.readAt ? item.readAt.toISOString() : null,\n      }))}\n      requiresOnboarding={user.role.startsWith(\"org_\") && !user.onboardedAt}\n    >\n      {children}\n    </PortalShell>\n  );\n}\n"],"names":[],"mappings":";;;;;;;;;AACA;AAAA;AACA;AACA;AACA;;;;;;AAEO,MAAM,WAAqB;IAChC,OAAO;IACP,aAAa;IACb,QAAQ;QAAE,OAAO;QAAO,QAAQ;QAAO,SAAS;IAAK;AACvD;AAEO,MAAM,UAAU;AAER,eAAe,aAAa,EACzC,QAAQ,EAGT;IACC,MAAM,UAAU,MAAM,IAAA,qIAAoB;IAC1C,MAAM,OAAO,MAAM,uHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI,QAAQ,IAAI,CAAC,EAAE;QAAC;QAC7B,SAAS;YAAE,KAAK;QAAK;IACvB;IAEA,IAAI,CAAC,MAAM;QACT,IAAA,iMAAQ,EAAC;IACX;IAEA,MAAM,CAAC,qBAAqB,oBAAoB,GAAG,MAAM,QAAQ,GAAG,CAAC;QACnE,uHAAM,CAAC,YAAY,CAAC,KAAK,CAAC;YACxB,OAAO;gBAAE,iBAAiB,KAAK,EAAE;gBAAE,QAAQ;YAAK;QAClD;QACA,uHAAM,CAAC,YAAY,CAAC,QAAQ,CAAC;YAC3B,OAAO;gBAAE,iBAAiB,KAAK,EAAE;YAAC;YAClC,SAAS;gBAAE,WAAW;YAAO;YAC7B,MAAM;QACR;KACD;IAED,MAAM,WAA4B;QAChC;YAAE,MAAM;YAAW,OAAO;YAAa,MAAM;QAAY;QACzD;YACE,MAAM;YACN,OAAO;YACP,MAAM;QACR;QACA;YACE,MAAM;YACN,OAAO;YACP,MAAM;QACR;QACA;YACE,MAAM;YACN,OAAO;YACP,MAAM;QACR;QACA;YAAE,MAAM;YAAkB,OAAO;YAAU,MAAM;QAAS;QAC1D;YACE,MAAM;YACN,OAAO;YACP,MAAM;QACR;KACD;IAED,IAAI,KAAK,IAAI,CAAC,UAAU,CAAC,SAAS;QAChC,SAAS,IAAI,CAAC;YACZ,MAAM;YACN,OAAO;YACP,MAAM;QACR;IACF,OAAO;QACL,SAAS,IAAI,CAAC;YACZ,MAAM;YACN,OAAO;YACP,MAAM;QACR;IACF;IAEA,SAAS,IAAI,CAAC;QACZ,MAAM;QACN,OAAO;QACP,MAAM;IACR;IAEA,IAAI,KAAK,IAAI,KAAK,gBAAgB;QAChC,SAAS,MAAM,CAAC,GAAG,GAAG;YACpB,MAAM;YACN,OAAO;YACP,MAAM;QACR;QACA,SAAS,IAAI,CAAC;YACZ,MAAM;YACN,OAAO;YACP,MAAM;QACR;QACA,SAAS,IAAI,CAAC;YACZ,MAAM;YACN,OAAO;YACP,MAAM;QACR;QACA,SAAS,IAAI,CAAC;YACZ,MAAM;YACN,OAAO;YACP,MAAM;QACR;IACF;IAEA,qBACE,8OAAC,mJAAW;QACV,UAAU;QACV,SAAS,KAAK,GAAG,CAAC,IAAI;QACtB,WAAW,KAAK,KAAK;QACrB,UAAU,KAAK,IAAI;QACnB,qBAAqB;QACrB,qBAAqB,oBAAoB,GAAG,CAAC,CAAC,OAAS,CAAC;gBACtD,IAAI,KAAK,EAAE;gBACX,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;gBACf,WAAW,KAAK,SAAS,CAAC,WAAW;gBACrC,QAAQ,KAAK,MAAM,GAAG,KAAK,MAAM,CAAC,WAAW,KAAK;YACpD,CAAC;QACD,oBAAoB,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,KAAK,WAAW;kBAEpE;;;;;;AAGP"}}]
}